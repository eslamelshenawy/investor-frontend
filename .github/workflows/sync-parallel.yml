name: Parallel Sync (5 Jobs)

# Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ù…ØªÙˆØ§Ø²ÙŠØ© - Ø£Ø³Ø±Ø¹ 5 Ù…Ø±Ø§Øª!
# ÙŠØ´ØºÙ„ 5 jobs Ø¨Ø§Ù„ØªÙˆØ§Ø²ÙŠØŒ ÙƒÙ„ ÙˆØ§Ø­Ø¯ ÙŠØ¹Ø§Ù„Ø¬ 10 categories

on:
  schedule:
    - cron: '0 3 * * *'  # ÙŠÙˆÙ…ÙŠØ§Ù‹ Ø§Ù„Ø³Ø§Ø¹Ø© 6 ØµØ¨Ø§Ø­Ø§Ù‹ (ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©)
  workflow_dispatch:  # Ù„Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ÙŠØ¯ÙˆÙŠ

env:
  DATABASE_URL: ${{ secrets.DATABASE_URL }}

jobs:
  # Part 1: Categories 1-10
  sync-part-1:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
      - name: Install dependencies
        run: npm ci
      - name: Install Chrome
        run: npx puppeteer browsers install chrome
      - name: Run Part 1
        run: node scripts/sync-part-1.cjs
        env:
          DATABASE_URL: ${{ secrets.DATABASE_URL }}

  # Part 2: Categories 11-20
  sync-part-2:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
      - name: Install dependencies
        run: npm ci
      - name: Install Chrome
        run: npx puppeteer browsers install chrome
      - name: Run Part 2
        run: node scripts/sync-part-2.cjs
        env:
          DATABASE_URL: ${{ secrets.DATABASE_URL }}

  # Part 3: Categories 21-30
  sync-part-3:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
      - name: Install dependencies
        run: npm ci
      - name: Install Chrome
        run: npx puppeteer browsers install chrome
      - name: Run Part 3
        run: node scripts/sync-part-3.cjs
        env:
          DATABASE_URL: ${{ secrets.DATABASE_URL }}

  # Part 4: Categories 31-40
  sync-part-4:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
      - name: Install dependencies
        run: npm ci
      - name: Install Chrome
        run: npx puppeteer browsers install chrome
      - name: Run Part 4
        run: node scripts/sync-part-4.cjs
        env:
          DATABASE_URL: ${{ secrets.DATABASE_URL }}

  # Part 5: Categories 41-48
  sync-part-5:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
      - name: Install dependencies
        run: npm ci
      - name: Install Chrome
        run: npx puppeteer browsers install chrome
      - name: Run Part 5
        run: node scripts/sync-part-5.cjs
        env:
          DATABASE_URL: ${{ secrets.DATABASE_URL }}

  # Summary Job - runs after all parts complete
  summary:
    needs: [sync-part-1, sync-part-2, sync-part-3, sync-part-4, sync-part-5]
    runs-on: ubuntu-latest
    steps:
      - name: Summary
        run: |
          echo "## ðŸŽ‰ Parallel Sync Complete!" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "All 5 sync jobs completed successfully." >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- Part 1: Categories 1-10 âœ…" >> $GITHUB_STEP_SUMMARY
          echo "- Part 2: Categories 11-20 âœ…" >> $GITHUB_STEP_SUMMARY
          echo "- Part 3: Categories 21-30 âœ…" >> $GITHUB_STEP_SUMMARY
          echo "- Part 4: Categories 31-40 âœ…" >> $GITHUB_STEP_SUMMARY
          echo "- Part 5: Categories 41-48 âœ…" >> $GITHUB_STEP_SUMMARY
